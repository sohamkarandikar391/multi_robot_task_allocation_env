<?xml version="1.0" ?>
<sdf version="1.9">
    <model name="differential_drive_robot">
        
        <link name="base_footprint"/>

        <joint name="base_joint" type="fixed">
            <parent>base_footprint</parent>
            <child>body_link</child>
            <pose>0 0 0.15 0 0 0</pose> 
        </joint>

        <link name="body_link">
            <inertial>
                <mass>10.0</mass>
                <inertia>
                    <ixx>0.083</ixx><ixy>0</ixy><ixz>0</ixz>
                    <iyy>0.216</iyy><iyz>0</iyz><izz>0.283</izz>
                </inertia>
            </inertial>
            <visual name="visual">
                <geometry>
                    <box><size>0.5 0.3 0.1</size></box>
                </geometry>
                <material>
                    <ambient>0.25 0.25 0.25 1</ambient>
                    <diffuse>0.25 0.25 0.25 1</diffuse>
                </material>
            </visual>
            <collision name="collision">
                <geometry>
                    <box><size>0.5 0.3 0.1</size></box>
                </geometry>
            </collision>
        </link>

        <joint name="left_wheel_joint" type="revolute">
            <parent>body_link</parent>
            <child>left_wheel_link</child>
            <pose relative_to="body_link">-0.15 0.175 -0.05 0 0 0</pose>
            <axis>
                <xyz>0 1 0</xyz>
                <limit>
                    <effort>100</effort>
                    <velocity>10.0</velocity>
                </limit>
                <dynamics>
                    <damping>0.1</damping>
                    <friction>0.1</friction>
                </dynamics>
            </axis>
        </joint>

        <link name="left_wheel_link">
            <pose relative_to="left_wheel_joint">0 0 0 1.5708 0 0</pose>
            <inertial>
                <mass>2.0</mass>
                <inertia>
                    <ixx>0.0054</ixx><ixy>0</ixy><ixz>0</ixz>
                    <iyy>0.0054</iyy><iyz>0</iyz><izz>0.01</izz>
                </inertia>
            </inertial>
            <visual name="visual">
                <geometry>
                    <cylinder><radius>0.1</radius><length>0.05</length></cylinder>
                </geometry>
                <material><ambient>0 0 0 1</ambient><diffuse>0 0 0 1</diffuse></material>
            </visual>
            <collision name="collision">
                <geometry>
                    <cylinder><radius>0.1</radius><length>0.05</length></cylinder>
                </geometry>
                <surface>
                    <friction><ode><mu>1.0</mu><mu2>1.0</mu2></ode></friction>
                </surface>
            </collision>
        </link>

        <joint name="right_wheel_joint" type="revolute">
            <parent>body_link</parent>
            <child>right_wheel_link</child>
            <pose relative_to="body_link">-0.15 -0.175 -0.05 0 0 0</pose>
            <axis>
                <xyz>0 1 0</xyz>
                <limit>
                    <effort>100</effort>
                    <velocity>10.0</velocity>
                </limit>
                <dynamics>
                    <damping>0.1</damping>
                    <friction>0.1</friction>
                </dynamics>
            </axis>
        </joint>

        <link name="right_wheel_link">
            <pose relative_to="right_wheel_joint">0 0 0 1.5708 0 0</pose>
            <inertial>
                <mass>2.0</mass>
                <inertia>
                    <ixx>0.0054</ixx><ixy>0</ixy><ixz>0</ixz>
                    <iyy>0.0054</iyy><iyz>0</iyz><izz>0.01</izz>
                </inertia>
            </inertial>
            <visual name="visual">
                <geometry>
                    <cylinder><radius>0.1</radius><length>0.05</length></cylinder>
                </geometry>
                <material><ambient>0 0 0 1</ambient><diffuse>0 0 0 1</diffuse></material>
            </visual>
            <collision name="collision">
                <geometry>
                    <cylinder><radius>0.1</radius><length>0.05</length></cylinder>
                </geometry>
                <surface>
                    <friction><ode><mu>1.0</mu><mu2>1.0</mu2></ode></friction>
                </surface>
            </collision>
        </link>

        <joint name="caster_joint" type="fixed">
            <parent>body_link</parent>
            <child>caster_link</child>
            <pose relative_to="body_link">0.15 0 -0.05 0 0 0</pose>
        </joint>

        <link name="caster_link">
            <pose relative_to="caster_joint">0 0 0 0 0 0</pose>
            <inertial>
                <mass>0.5</mass>
                <inertia>
                    <ixx>0.002</ixx><ixy>0</ixy><ixz>0</ixz>
                    <iyy>0.002</iyy><iyz>0</iyz><izz>0.002</izz>
                </inertia>
            </inertial>
            <visual name="visual">
                <geometry>
                    <sphere><radius>0.1</radius></sphere>
                </geometry>
                <material><ambient>0 0 0 1</ambient><diffuse>0 0 0 1</diffuse></material>
            </visual>
            <collision name="collision">
                <geometry>
                    <sphere><radius>0.1</radius></sphere>
                </geometry>
                <surface>
                    <friction><ode><mu>0.01</mu><mu2>0.01</mu2></ode></friction>
                </surface>
            </collision>
        </link>

        <plugin filename="gz-sim-diff-drive-system" name="gz::sim::systems::DiffDrive">
            <right_joint>right_wheel_joint</right_joint>
            <left_joint>left_wheel_joint</left_joint>
            <wheel_separation>0.35</wheel_separation>
            <wheel_radius>0.1</wheel_radius>
            <max_linear_acceleration>10</max_linear_acceleration>
            <odom_publish_frequency>100</odom_publish_frequency>
            <topic>cmd_vel</topic>
            <odom_topic>odometry</odom_topic>
        </plugin>

        <plugin filename="gz-sim-joint-state-publisher-system" name="gz::sim::systems::JointStatePublisher">
            <topic>joint_states</topic>
            <joint_name>right_wheel_joint</joint_name>
            <joint_name>left_wheel_joint</joint_name>
        </plugin>

        <plugin filename="gz-sim-pose-publisher-system" name="gz::sim::systems::PosePublisher">
            <publish_link_pose>true</publish_link_pose> <publish_visual_pose>false</publish_visual_pose>
            <publish_collision_pose>false</publish_collision_pose>
            <publish_sensor_pose>false</publish_sensor_pose>
            
            <publish_nested_model_pose>true</publish_nested_model_pose> <use_pose_vector_msg>true</use_pose_vector_msg>
            <static_publisher>false</static_publisher>
            <static_update_frequency>100</static_update_frequency>
        </plugin>

    </model>
</sdf>